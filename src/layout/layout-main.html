<link rel="import" href="../../bower_components/polymer/polymer.html">
 
<link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-item/paper-icon-item.html">

<link rel="import" href="./layout-main-toolbar.html">

<link rel="import" href="./layout-main-drawer.html">


<dom-module id="layout-main">
	<template>
	<style is="custom-style" include="gl-color gl-size gl-toast">
		#drawer{
			z-index: 2;
			--app-drawer-width: 400px;
		}
		.offline{
			position:fixed;
			top:0;
			right:0;
			width:100%;
			height:100%;
			background-color:#000;
			z-index:10;
			
			opacity: 0.7;
			filter: alpha(opacity=70);
		}

		.offline>.flex-container{
			display: -webkit-flex;
    		display: flex;
			width:100%;
			height:100%;
		}

		.offline>.flex-container>.flex-item {
			margin: auto;
			color:#FFF;
			text-align:center;
			font-size:1.5em;
			font-family: 'rsuregular', sans-serif;
        	-webkit-font-smoothing: antialiased;
		}

		[blur]{
			-webkit-filter: blur(0.5px);
			-moz-filter: blur(0.5px);
			-o-filter: blur(0.5px);
			-ms-filter: blur(0.5px);
			filter: blur(0.5px);
		}

		paper-spinner{
			--paper-spinner-stroke-width: 3px;
		}
		.toastLoading, .toastSuccess, .toastWarning, .toastError,.toastDialog{
			width: 100%;
			text-align: center;
			font-size: 22px;
			font-family: 'rsubold', sans-serif;
        	-webkit-font-smoothing: antialiased;
			color: white;
		}
		.toastLoading>span{
			padding-left:10px; 
			position:relative; 
			bottom: 6px;
		}
		.toastSuccess{
			background-color: #5cb85c;
		}
		.toastSuccess>span{
			padding-left:10px;
		}
		.toastWarning{
			background-color: #f0ad4e;
		}
		.toastError,.toastConnectError{
			background-color: #d9534f;
		}
		.toastConnectError,.toastDialog{
			width: 100%;
			text-align: center;
		}
		.toastDialog{
			background-color: #337ab7;
		}
		.toastConnectError>span{
			font-size: 16px;
		}
		iron-icon{
			height: auto;
			width: 30px;
			margin-bottom: 5px;
		}
		paper-button{
			height: 30px;
			width: 10px !important;
			font-size: 16px !important;
			border-radius: 2px;

		}
		/*paper-button:hover{
			background-color: #f0ad4e;
		}*/
		.btYes{
			background-color: #5cb85c;
		}
		.btNo{
			background-color: #d9534f;
		}


	</style>
	<div blur$="{{offline}}">
		<app-drawer id="drawer">
			<layout-main-drawer path="{{path}}" on-toggle-drawer="_toggleDrawer"></layout-main-drawer>
		</app-drawer>

		<app-header-layout style="z-index:1;">
			<app-header fixed condenses effects="waterfall">
				<layout-main-toolbar on-toggle-drawer="_toggleDrawer"></layout-main-toolbar>
			</app-header>
		</app-header-layout>

		<content on-toast="_toastManage"></content>
		
		<paper-toast class="gl-toast-loading" id="toastLoading" positionTarget duration="0" text="">
                <paper-spinner active></paper-spinner>
                <span>
                    กำลังโหลด... 
                </span>
        </paper-toast>
		
		<paper-toast class="toastDialog" id="toastDialog" duration="0">
			<span>{{status.content}}</span>
			<div style="padding: 10px 20px 10px 20px;">
				<paper-button class="btYes" on-tap="resultToastDialog" confirm>Yes</paper-button>
				<paper-button class="btNo" on-tap="resultToastDialog">No</paper-button>
			</div>
		</paper-toast>

		<paper-toast class="toastConnectError" id="toastErrorConnect" duration="0">
			<span>{{status.content}}</span>
			<paper-button on-tap="closeToastConnectError" style="color:yellow;">Close now!</paper-button>
		</paper-toast>

		<paper-toast class$="{{status.class}}" id="toastStatus">
			<iron-icon icon="{{status.icon}}"></iron-icon>
			<span>
				{{status.content}}
			</span>
		</paper-toast>
		
	</div>
	<div class="offline" hidden$="{{!offline}}">
		<div class="flex-container">
			<div class="flex-item"><paper-spinner active></paper-spinner><br>Unable to connect to the Internet<br>&#34 Connecting... Please wait &#34</div>
		</div>
	</div>
	</template>


	<script>
        Polymer({
            is:'layout-main',
			ready:function(){
				this.offline = navigator.onLine === false;
				window.addEventListener('online',function(){
					this.offline = false;
				}.bind(this))
				
				window.addEventListener('offline',function(){
					this.offline = true;
				}.bind(this))
			},
			_toggleDrawer:function(){
				this.$.drawer.toggle();
			},
			_toastManage:function(e){
				this.data = e.detail.status;
				//console.log('_toastManage');
				//console.log(e.detail.status);
				if(e.detail.status == 'load'){
					//console.log('load');
					this.openToastLoading();
				}
				else if(e.detail.status == 'loadSuccess'){
					this.closeToastLoading();
				}
				if(e.detail.status == 'success'){
					this.closeToastLoading(e.detail.callback);
					console.log(e.detail.text);
					//Polymer.dom(this.root).setAttribute('class', 'toastSuccess')
					this.status = {
						class : 'gl-toast-success',
						icon : 'done',
						content : e.detail.text || 'โหลดข้อมูลสำเร็จ'
					}
				}
				if(e.detail.status == 'connectError'){
					console.log(e.detail.text);
					this.status = {
						content : e.detail.text
					}
					this.$.toastErrorConnect.open();
				}
				if(e.detail.status == 'openDialog'){
					this.status = {
						class : 'toastDialog',
						icon : 'done',
						content : e.detail.text || 'โหลดข้อมูลสำเร็จ'
					}

					this.openToastDialog(e.detail)
				}
			},
			openToastLoading:function(){
                this.$.toastLoading.open();
            },
            closeToastLoading:function(callback){
                this.async(function(){
					console.log('async');
                    this.$.toastLoading.hide();
					this.openToastStatus();
					callback();
                }.bind(this),500);
            },
			openToastDialog:function(detail){
				this.$.toastDialog.open();
				this.detailToastDialog = detail;
				
			},
			resultToastDialog:function(e){
				
				var result = true;
				if(e.currentTarget.getAttribute('confirm')==null){
					result = false;
				}
				this.detailToastDialog.confirmed(result,this.detailToastDialog);
				this.closeToastDialog();
			},
			closeToastDialog:function(){
				this.$.toastDialog.hide();
			},
			openToastConnectError:function(){
				this.$.toastErrorConnect.open();
			},
			closeToastConnectError:function(){
				this.$.toastErrorConnect.hide();
			},
			openToastStatus:function(){
				this.$.toastStatus.open();
			}
        });
    </script>
</dom-module>