
<link rel="import" href="/bower_components/vaadin-upload/vaadin-upload.html">



<dom-module id="page-upload">
    <template>
        <br><br>
        <vaadin-upload 
            id="preFill" 
            target="/api/upload/file" 
            files="{{listFiles}}" 
            method="POST" 
            timeout="300000" 
            accept="application/pdf"
            on-file-abort="_deleteFile"
            on-upload-success="_uploadSuccess"
        >
            <div class="drop-label">
                <iron-icon icon="description"></iron-icon>
                Drop your files
            </div>
            <div id="fileList" class="file-list">
                <div id="fileList">
                    <template is="dom-repeat" items="[[listFiles]]" as="file">
                        <vaadin-upload-file file="[[file]]" on-tap="downloadFile" style="cursor:pointer" file-id="[[file.file_id]]"></vaadin-upload-file>
                    </template>
                </div>
            </div>
        </vaadin-upload>
    </template>
    <script>
        Polymer({
            is: 'page-upload',
            properties:{
                listFiles:{
                    type:Array,
                    observer:'fileChanged'
                }
            },
            fileChanged:function(newVal,oldVal){
                console.log(newVal);
            },
            ready:function(){
                axios.get('/upload/list')
                .then( (response)=>{
                    this.listFiles = response.data;
                })
                .catch(function (error) {
                    console.log(error);
                });


            },
            downloadFile:function(e){
                console.log(e.target.getAttribute('class'));
                if(e.target.getAttribute('class')==null){
                    window.location = '/api/upload/file/'+e.currentTarget.fileId;
                }
                
            },
            _deleteFile:function(e){
                axios.delete('/upload/file/'+e.detail.file.file_id)
                .then( (response)=>{
                    console.log(response);
                })
                .catch(function (error) {
                    console.log(error);
                });

            },
            _uploadSuccess:function(e){
                //console.log(this.listFiles.length);

                console.log(e.detail.file.name)
                // this.splice('listFiles', 0, 1, 
                //     {
                //         "complete": true,
                //         "file_id": "ef879b81-c4b0-4ce0-83cb-b69aeef0cdc8",
                //         "name": "ssssss.pdf",
                //         "progress": 100
                //     }
                // )
            }
        });
    </script>
</dom-module>