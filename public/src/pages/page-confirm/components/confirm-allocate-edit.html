<link rel="import" href="../../../../../bower_components/gl-form/gl-form-panel.html">
<link rel="import" href="./../../components/format-number-behavior.html">
<link rel="import" href="./../../components/month-behavior.html">

<dom-module id="confirm-allocate-edit">
  <style is="custom-style" include="iron-flex iron-flex-alignment gl-color">
    *{
      text-align: left;
    }
    .title{
      padding: 10px;
      font-size: 18px;
      color: white;
      background-color: orange;
      /*width: 25%;*/
    }
    .content,paper-button{
      font-size:16px;
      margin-top: 26px;
      font-family: 'CSChatThaiUI', sans-serif !important;
      -webkit-font-smoothing: antialiased;
    }
    table.default {
      border-collapse: collapse;
      width: 100%
    }

    table.default,
    th,
    td {
      border-bottom: 1px solid #ddd;
    }

    th,
    td {
      padding: 15px;
    }

    th {
      text-align: center;
      background-color: #F1F1F1;
      white-space: nowrap;
    }

    td {
      text-align: left;
      white-space: nowrap;
    }

    tr:hover {
      background-color: #F1F1F1;
    }
    .number{
      text-align: right;
    }
    .textHeader{
      padding:20px;
      text-align: center;
      font-size: 22px;  
    }
  </style>
  <template>
    <!--<div class="textHeader">ยืนยันรับส่วนจัดสรร</div>-->
    <gl-form-panel set-padding = "0px 0px 20px 0px">
      <div class="title">ข้อมูลบริษัท</div>
     
      <gl-form-panel-body set-padding = "0px 0px 0px 0px" set-border="0px">
         <gl-grid-row width="{{getWidth}}">
          <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,2]]">
          </gl-grid-col>
          <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]">
            <gl-form-label-input label="เลขประจำตัวผู้เสียภาษี" value="0105507002443"></gl-form-label-input>
          </gl-grid-col>
          <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]">
            <!--<gl-form-label-input label="ชื่อบริษัท(ไทย)" value="{{data.a}}"></gl-form-label-input>-->
          </gl-grid-col>
           <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]">
             <gl-form-label-input label="ชื่อบริษัท(ไทย)" value="{{data.name}}"></gl-form-label-input>
            <!--<gl-form-label-input label="ชื่อบริษัท(อังกฤษ)" value="Kamolkich., Ltd"></gl-form-label-input>-->
          </gl-grid-col>
           <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,2]]">
           </gl-grid-col>
        </gl-grid-row>
      </gl-form-panel-body>
    </gl-form-panel>

    <gl-form-panel set-padding = "0px 0px 20px 0px">
      <div class="title">รายละเอียดปริมาณจัดสรร</div>
      <gl-form-panel-body set-padding = "0px 0px 0px 0px" set-border="0px">
         <gl-grid-row width="{{getWidth}}">
          <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]"></gl-grid-col>
          <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,2]]"></gl-grid-col>
          <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,2]]"></gl-grid-col>
           <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,2]]">
               <!--<div>ยอดปรับปรุง</div>-->
           </gl-grid-col>
        </gl-grid-row>

          <gl-grid-row width="{{getWidth}}">
          <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,2]]"></gl-grid-col>
          <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,2]]">
              <div class="content">ปริมาณโควตารวม :</div>
          </gl-grid-col>
           <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,2]]">
                <div class="content">{{formatNumber(defaultAmount)}}</div>
               <!--<gl-form-input class="number" format-number="on" value="{{defaultAmount}}" disabled></gl-form-input>-->
           </gl-grid-col>
             <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,2]]">
              <div class="content">ปริมาณโควตารวม :</div>
          </gl-grid-col>
           <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,2]]">
               <gl-form-input class="number" format-number="on" value="{{amount}}"></gl-form-input>
           </gl-grid-col>
          </gl-grid-row>
        
     
               <template is="dom-repeat" items="[[data.quantity]]">
                 <!--[[getQuantity(item)]]-->
                <gl-grid-row width="{{getWidth}}">
                  <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,2]]"></gl-grid-col>
                  <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,2]]">
                      <div class="content">ปริมาณ งวดที่ {{item.period}} [[getMonthName(item.month)]] :</div>
                  </gl-grid-col>
                  <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,2]]">
                      <div class="content">[[formatNumber(item.weigth)]]</div>
                      <!--<gl-form-input class="number" allowed-pattern="[0-9||,||.]" format-number="on" value="[[item.weigth]]" disabled></gl-form-input>-->
                  </gl-grid-col>
                  <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,2]]">
                      <div class="content">ปริมาณ งวดที่ {{item.period}} [[getMonthName(item.month)]] :</div>
                  </gl-grid-col>
                  <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,2]]"> 
                    <!--[[mathPercent(item.weigth,item.percent,amount,item.period,index)]]-->
                      <gl-form-input class="number" allowed-pattern="[0-9||,||.]" format-number="on" value="[[mathPercent(item,amount,index)]]"></gl-form-input>
                  </gl-grid-col>
                  </gl-grid-row>
                </template>
  
      </gl-form-panel-body>
    </gl-form-panel>

    <div class="horizontal end-justified layout">
        <paper-button class="gl-btn-danger" raised>ยกเลิก</paper-button>
        <paper-button class="gl-btn-success" on-tap="_saveData" raised>{{status}}</paper-button>
    </div>
   
  </template>
  <script>
    Polymer({
      is: "confirm-allocate-edit",
      behaviors:[FormatNumberBehavior,MonthBehavior],
      properties:{
        status:{
          type: String,
          value: '??'
        },
        data:{
            type: Object,
            observer: '_getData'
        },
        quantityUpdate:{
          type: Array,
          value: []
        }
      
      },
      ready:function(){
        this.answer = 0;
      },
      _getData:function(){
        this.defaultAmount = this.data.amount;
        this.amount = this.data.amount;
      },
      mathPercent:function(item,amount,index){
        if(this.data.amount != amount){
          this.data.quantity[index].weigth = this.unFormat(amount)*item.percent/100;
          return this.unFormat(amount)*item.percent/100;
        }
        if(this.data.amount == amount){
          // console.log(this.quantityUpdate);
          return item.weigth;
        }       
      },
      sumData:function(data){
        data.map((item)=>{
          this.answer += item.weigth;
        });
        return this.answer;
      },
      _saveData:function(){
        var quantityUpdate = this.data.quantity.map((item)=>{
          var {period,weigth} = item;
          var newitem = {period,weigth};
          return newitem;
        });
        this.datas = {
          confirm:{
            amount : this.unFormat(this.amount),
            exporter_id : this.data.exporter_id,
            quantity : quantityUpdate,
            type_rice_id : this.data.type_rice_id,
            year : this.data.year
          },
          notify:{
             id_notify : this.data.id_notify
          }
        }
        this.fire('save-data',this.datas);
      }
    });
  </script>
</dom-module>
