<script src="./../bower_components/rxjs/dist/rx.lite.min.js"></script>
<script src="./../bower_components/paho-mqtt/src/mqttws31.js"></script>
<script>
nylonMqtt = {} || nylonMqtt;

nylonMqttBehavior = {
    nylonMqttConnect:function(connectionName,hostName,port,clientId){

        nylonMqtt[connectionName] = {
             connected:false,
             onConnect:new Rx.Subject(),
             onMessage:new Rx.Subject(),
             onLost:new Rx.Subject()
        };

        nylonMqtt[connectionName].client = new Paho.MQTT.Client(hostName, Number(port), clientId);

        nylonMqtt[connectionName].client.onMessageArrived = function(msg){
            nylonMqtt[connectionName].onMessage.onNext(msg);
        }
        nylonMqtt[connectionName].client.onConnectionLost = function(response){
            nylonMqtt[connectionName].onConnect.onNext(response);
        }

        nylonMqtt[connectionName].client.connect({onSuccess:function(){
            nylonMqtt[connectionName].connected = true;
            nylonMqtt[connectionName].onConnect.onNext(nylonMqtt[connectionName].client);
        }});
    },
    nylonMqttOn:function(connectionName,event,callback){
        if(event=="connected"){

            if(nylonMqtt[connectionName].connected==false){
                nylonMqtt[connectionName].onConnect.subscribe(function (data) {
                    callback(data);
                });
            }else{
                callback(data);
            }
            
        }else if(event=="message"){
            nylonMqtt[connectionName].onMessage.subscribe(function (data) {
                callback(data.destinationName,data.payloadString,data);
            });
        }else if(event=="lost"){
            nylonMqtt[connectionName].onLost.subscribe(function (response) {
                callback(response);
            });
        }
    }
};


</script>