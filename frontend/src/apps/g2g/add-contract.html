<link rel="import" href="panel-seleted.html"> ้
<link rel="import" href="panel-seleted-vessel.html">
<link rel="import" href="components/grid/nx-grid.html">
<link rel="import" href="components/content-panel.html">

<!-- <link rel="import" href="/components/vessel/shipment-insert.html"> -->
<link rel="import" href="components/vessel/shipment-insert.html">
<link rel="import" href="components/promise/promise-page.html">
<link rel="import" href="/bower_components/numeral-js/numeral-js.html">
<link rel="import" href="../../../bower_components/chart-elements/chart-elements.html">
<dom-module id="g2g-add-contract">
    <style is="custom-style" include="iron-flex iron-flex-factors iron-flex-alignment gl-color gl-size">
        * {
            font-family: 'rsuregular', sans-serif;
            -webkit-font-smoothing: antialiased;
        }
        :host{
          --paper-card:{
            width: 600px;
            /*height: 462px;*/
            margin: 5px 15px 15px 10px;
          }
        }
        .left {
            margin: 0px 10px 0px 10px;
        }
        .button{
          margin: 5px;
        }
        .statistic {
          --paper-card:{
            width: auto;
            margin: 5px 10px 10px 10px;
          }
        }
        chart-pie {
          width: 350px;
          /*height: 400px;*/
        }
        .nomalFont {
          font-size: var(--font-size-h4);
        }
        numeral-js {
          padding-left: 5px;
          float: right;
        }
        .total {
          margin-left: 5px;
        }
    </style>
    <template>
      <content-panel>
        <grid>
          <div class="horizontal center-justified layout">
            <div id="content" class="layout vertical wrap">
              <div id="head">
                 <paper-card class="statistic" heading="Statistic" alt="Statistic">
                   <div class="card-content layout horizontal">
                     <chart-line data="[[chart]]"></chart-line>
                     <chart-line data="[[chart]]"></chart-line>
                     <chart-line data="[[chart]]"></chart-line>
                     <chart-line data="[[chart]]"></chart-line>
                   </div>
                 </paper-card>
              </div>
              <div id="body">
                <paper-material elevation="1">
                  Contract
                </paper-material>
                <template is="dom-repeat" items="[[contracts]]">
                  <paper-card heading="[[item.contract_name]]" alt="[[item.contract_name]]">
                     <div class="card-content horizontal layout">
                       [[computeContract(item.*)]]
                       <chart-pie data="[[dataContractChart]]"></chart-pie>
                       <div class="layout vertical">
                           <div class="flex nomalFont">ทั้งหมด</div>
                           <div class="flex nomalFont">ทำสัญญาแล้ว</div>
                           <div class="flex nomalFont">คงเหลือ</div>
                       </div>
                       <div class="layout vertical">
                           <div class="flex nomalFont number">:<numeral-js number="[[item.contract_quantity_total]]" format="0,0" print></numeral-js>  </div>
                           <div class="flex nomalFont number">:<numeral-js number="[[item.contract_quantity_confirm]]" format="0,0" print></numeral-js>  </div>
                           <div class="flex nomalFont number">:<numeral-js number="[[item.contract_quantity_balance]]" format="0,0" print></numeral-js>  </div>
                       </div>
                       <div class="layout vertical">
                           <div class="flex nomalFont total"> ตัน</div>
                           <div class="flex nomalFont total"> ตัน</div>
                           <div class="flex nomalFont total"> ตัน</div>
                       </div>
                     </div>
                     <div class="card-actions horizontal end-justified layout">
                       <paper-button on-tap="editContract" data="[[item]]">Contract</paper-button>
                       <paper-button on-tap="editConfirm" data="[[item]]">ConfirmMation Litter</paper-button>
                       <paper-button>Shipment</paper-button>
                       <paper-button>Payment</paper-button>
                     </div>
                   </paper-card>
                </template>
                <paper-card class="horizontal layout center center-justified">
                  <div class="card-content">[[layerContent]]
                    <paper-button raised class="gl-large gl-btn-primary">Create New Contract</paper-button>
                  </div>
                </paper-card>
             </div>
            </div>
          </div>

        </grid>
      <panel><iron-pages selected="{{layerContent}}" attr-for-selected="name">


              <div name="primary">
                <panel-seleted>
                  <section-content name="detail">
                    <promise-detail data="{{dataContract}}" type-rice=[[typeRice]]></promise-detail>
                  </section-content>
                  <section-content name="print">
                      <vessel-print></vessel-print>
                  </section-content>
                  <section-content name="file">
                      <promise-fileup></promise-fileup>
                  </section-content>
                </panel-seleted>
              </div>
              <div name="secondary">
                <promise-page data="[[dataContract.confirm_letter]]"></promise-page>
                <!-- <panel-seleted>

                  <section-content name="detail">

                  </section-content>
                  <section-content name="print">
                      <vessel-print></vessel-print>
                  </section-content>
                  <section-content name="file">
                      <promise-fileup></promise-fileup>
                  </section-content>
                </panel-seleted> -->
              </div>
              <div name="third">
333333333
              </div>
            </iron-pages>



      </panel>

      </content-panel>

    </template>
    <script>
        Polymer({
            is: "g2g-add-contract",
            listeners: {
                // 'nx-grid-tap': 'nxGridTap',
                // 'nx-grid-dblclick': 'nxGridDblclick'
            },
            behaviors: [
                gl.behavior.core,
                gl.behavior.locales
            ],
            properties: {
                layerContent: {
                    type: String,
                    value: "primary"
                },
                vesselPage: {
                    type: Number,
                    value: 0
                },
                idData: {
                    type:String,
                    value:''
                },
                common:{
                  type:Object,
                  value:{}
                },
                bmc:{
                  type:Object,
                  value:{}
                }
            },
            observers:[
              // 'getPortCountry(contractId)'
            ],
            created: function() {
                this.glSetTitle('ทำสัญญา');
                this.glSetLayout('layout-main');
                this.glQuery('addContract',this);
            },
            ready: function() {
              // console.log(this.loaded);
              // list county
              this.getChange(false,'get');
              // list riceType
              this.getDb('./common/typeRice',(data)=>{
                this.typeRice=data;
              },false);
              // list package
              this.getDb('./common/package',(data)=>{
                this.package=data;
              },false);
              this.getDb('./common/seller',(data)=>{
                  this.common.seller= data;
                  // console.log(this.common.seller);
              },false);
              this.getDb('./common/carrier',(data)=>{
                //เอาข้อมูลไปยัดลง item ใน คอมโบบล็อก id carrier_id
                  this.common.carrier= data;
              },false);
              //shipline_id
              this.getDb('./common/shipline/',(data)=>{
                this.common.shipline = data;
              },false);
              //ship in shipline
              this.getDb('./common/shipline/ship',(data)=>{
                this.common.shipInShipline = data;
              },false);
              //get surveyor_id
              this.getDb('./common/surveyor',(data)=>{
                this.common.surveyor = data;
              },false);
              // list port
              this.getDb('./common/port/',(data)=>{
                this.common.countryport =  data;

              },false);
              // list incoterms  ชนิดการจ่าย
              this.getDb('./common/incoterms',(data)=>{
                this.incoterms=data;
              },false);

              this.chart = {
                labels: ["January", "February", "March", "April", "May", "June", "July"],
                datasets: [
                  {
                    label: "My First dataset",
                    backgroundColor: "rgba(220,220,220,0.2)",
                    borderColor: "rgba(220,220,220,1)",
                    borderWidth: 1,
                    pointBackgroundColor: "rgba(220,220,220,1)",
                    pointBorderColor: "#fff",
                    pointHoverBackgroundColor: "#fff",
                    pointHoverBorderColor: "rgba(220,220,220,1)",
                    data: [65, 59, 80, 81, 56, 55, 40]
                  },
                  {
                    label: "My Second dataset",
                    backgroundColor: "rgba(151,187,205,0.2)",
                    borderColor: "rgba(151,187,205,1)",
                    borderWidth: 1,
                    pointBackgroundColor: "rgba(151,187,205,1)",
                    pointBorderColor: "#fff",
                    pointHighlightFill: "#fff",
                    pointHoverBorderColor: "rgba(151,187,205,1)",
                    data: [28, 48, 40, 19, 86, 27, 90]
                  }
                ]
                };




            },
            getChange:function (refresh,action) {
              // console.log('action ',action);
              this.getDb('./g2g/contract/list',(data)=>{
                this.contracts=data;
                // console.log(  this.contract);
                // dataContract
              },refresh,action)
            },
            computeContract:function (para) {
                // console.log(para.base.contract_quantity_balance);
                // console.log(para.base.contract_quantity_confirm);
                // console.log(para.base.contract_quantity_total);
                this.dataContractChart = {
                      labels: [
                        // "ทั้งหมด (ตัน)",
                        "ทำสัญญาแล้ว (ตัน)",
                        "คงเหลือ (ตัน)"
                      ],
                      datasets: [
                        {
                          data: [
                                //  para.base.contract_quantity_total,
                                 para.base.contract_quantity_confirm,
                                 para.base.contract_quantity_balance
                               ],
                          backgroundColor: [
                            "#FF6384",
                            "#36A2EB",
                            "#FFCE56"
                          ],
                          hoverBackgroundColor: [
                            "#FF6384",
                            "#36A2EB",
                            "#FFCE56"
                          ]
                        }]
                    };
                // console.log("vy");
            },
            test:function () {
              console.log('เข้าโวยยยยยยยยยย');
            },
            editContract:function (e) {
              this.layerContent="primary";
              // console.log(e.currentTarget.data);
              this.dataContract = e.currentTarget.data;
              this.glQuery('contentPanel').changDrawer();
            },
            editConfirm:function (e) {
              this.layerContent="secondary";
              // console.log(e.currentTarget.data);
              this.dataContract = e.currentTarget.data;
              this.glQuery('contentPanel').changDrawer();
            },
            vesselEditCommon:function (e) {
              // console.log(e.detail.node);

              e.detail.node.common=this.common;
            },
            vesselInsertCommon:function (e) {
              // console.log(e.detail.node);
              e.detail.node.common=this.common;
            },
            confirmMationCommon:function (e) {
              // console.log(e.detail.node);
              e.detail.node.common=this.confirmLetter;
            },
            shipMentDeatil:function (id,refresh,action) {
              // get put delete
              // console.log(action);
              if (action == 'get') {
                this.glQuery('layoutMain').openToastLoading();
              }
              //
              this.getDb('./g2g/shipment/id/'+id,(data)=>{
                this.getDb('./g2g/contract/id/'+data.contract_id,(data2)=>{
                  data.country =  data2.country_id;
                  data.buyerMasks =  data2.buyer_masks;
                  this.shipMent = data;
                },refresh,action);
              });
            },
            getconfirm:function (contractId) {
                this.getDb('./g2g/confirm/contract/id/'+contractId,(data)=>{
                  this.cml = data;
                  // console.log(this.cml);
                  // this.cl_id.items = data;
                });
            },
            conFirmDeatil:function (cmlId) {
              this.glQuery('layoutMain').openToastLoading();
              this.getDb('./g2g/confirm/id/'+cmlId,(data)=>{
                this.confirmLetter = data;
                // console.log(this.confirmLetter);
              },true,'get');
            },
            getDb:function (url,callback,refresh,action) {
              // console.log(url);
              axios.get(url)
                .then((response)=>{
                    callback(response.data);
                    // console.log(action);
                      switch (action) {
                          case 'get':
                                    this.glQuery('layoutMain').closeToastLoading(function(){
                                    this.checkRefresh(refresh);
                                    }.bind(this));
                          break;
                          // insert & updoate
                          case 'put':
                                    this.glQuery('layoutMain').closeToastSaveing(function(){
                                      this.checkRefresh(refresh);
                                    }.bind(this));
                          break;
                          case 'delete':
                                    this.glQuery('layoutMain').closeToastDeleteing(function(){
                                      this.checkRefresh(refresh);
                                    }.bind(this));
                          break;
                      }
                })
                .catch((error)=> {
                  console.log(error);
                });
                // console.log(1);
            },
            checkRefresh:function (refresh) {
              if (refresh == true) {
                this.glQuery('contentPanel').changDrawer();
              }
            },
            attached:function(){
              this.layoutMain = this.glQuery('layoutMain');

              var resolvedPageUrl = this.resolveUrl(`components/promise/promise-insert.html`);
              this.importHref(resolvedPageUrl,null,null,true);

              var resolvedPageUrl = this.resolveUrl(`components/promise/promise-confirm.html`);
              this.importHref(resolvedPageUrl,null,null,true);

              var resolvedPageUrl = this.resolveUrl(`components/promise/promise-detail.html`);
              this.importHref(resolvedPageUrl,null,null,true);

              var resolvedPageUrl = this.resolveUrl(`components/promise/promise-fileup.html`);
              this.importHref(resolvedPageUrl,null,null,true);

              var resolvedPageUrl = this.resolveUrl(`components/vessel/vessel-print.html`);
              this.importHref(resolvedPageUrl,null,null,true);

              var resolvedPageUrl = this.resolveUrl(`components/vessel/vessel-page.html`);
              this.importHref(resolvedPageUrl,null,null,true);

              this.async(()=>{this.loaded = true;},1000);

            },

        });;
    </script>
</dom-module>
