<link rel="import" href="../list-edit/listEditBehavior.html">
<link rel="import" href="invoice-save.html">
<link rel="import" href="invoice-edit.html">
<dom-module id="invoice-page">
<style include="iron-flex iron-flex-factors iron-flex-alignment gl-color gl-size">
  .text {
    text-align: center;
    font-size: var(--font-size-large);
  }
  paper-icon-button.pink {
  margin: 5px 5px 5px 5px;
 }
 paper-icon-button.pink:hover {
   background-color: var(--paper-grey-200);
   border-radius: 5px;
   box-shadow: inset 0 0 3px 3px rgba(0,0,0,.2);
   /*background-color: var(--paper-pink-500);
   color: white;*/
 }
</style>
<template>


  <div id="removePen" hidden$="{{compute(ishidden)}}" class="horizontal end-justified layout" >
    <div class="dd" hidden$="{{compute(ishidden)}}">
        <paper-icon-button id="editInvoice" class="pink" icon="create" on-tap="editChange" ></paper-icon-button>
    </div>
    <paper-icon-button id="deleteInvoice" class="pink" icon="delete" on-tap="deleteChange"></paper-icon-button>
  </div>
  <paper-tooltip for="editInvoice" position="bottom" animation-delay="0">Edit Invoice</paper-tooltip>
  <paper-tooltip for="deleteInvoice" position="bottom" animation-delay="0">Delete Invoice</paper-tooltip>
  <hr>
  <!-- <gl-form-panel set-border="0px"> -->
    <div class="text">NEW COMMERCIAL INOVICE</div>
  <gl-form-panel-head label="" set-padding="10px" set-border="1px">
  </gl-form-panel-head>
    <iron-pages selected="{{pages}}">
        <invoice-save data="{{data}}" name-rice="[[nameRice]]"></invoice-save>
        <invoice-edit data="{{data}}" name-rice="[[nameRice]]"></invoice-edit>
    </iron-pages>



  <gl-form-panel-footer>
    <paper-button id="removeButtom" class="gl-btn-success" on-tap="saveEdit" raised hidden>บันทึก</paper-button>
  </gl-form-panel-footer>
  <!-- </gl-form-panel> -->


</template>
<script>
Polymer({
  is: "invoice-page",
  behaviors: [listEditBehavior,  gl.behavior.core,],
  properties: {
    pages:{
      type:Number,
      value: 0
    },
    data:{
      type:Object
    },
    nameRice: {
      type: String,
      value:''
    },
    ishidden: {
      type: Boolean,
      value: false
    },
    saveData:{
      type:Object,
      value:{
              id:'',
              bl_no:'',
              invoice_date:'',
              invoice_no:'',
              made_out_to:'',
            }
    },
  },
  observers:['check(data)'],
  ready: function() {
    // this.$$('#removePen').removeAttribute("hidden");
    // this.ishidden = !this.ishidden;
  },
  check:function (data) {
    var rice = data.cl_type_rice;
    // console.log(rice);
    // console.log(this.nameRice.length);
    if (this.nameRice.length == 0) {
      rice.map((el)=>{
        // console.log(typeof el.type_rice_desc_en !== 'undefined');
        // console.log(el.type_rice_desc_en);
          // if (typeof el.type_rice_desc_en !== 'undefined') {
            this.nameRice += el.type_rice_desc_en+', ';
          // }
      });
    }
  // console.log(this.nameRice);
    // this.mockUpdata = data;
  },
  compute: function() {
    // console.log("computing...");
    // console.log(this.ishidden);
    return this.ishidden;
  },
  editChange:function(e){
     this.ishidden = !this.ishidden;
    this.pages = 1;
    this.$$('#removeButtom').removeAttribute("hidden");
    // this.$$('#removePen').setAttribute("hidden", "hidden");
  },
  saveEdit:function(e) {
     this.ishidden = !this.ishidden;
    // console.log(this.data);
    this.pages = 0;
    this.$$('#removeButtom').setAttribute("hidden", "hidden");
    // this.$$('#removePen').removeAttribute("hidden");

    this.saveData.id = this.data.invoice_id;
    this.saveData.bl_no = this.data.bl_no;
    this.saveData.invoice_date =new Date(this.data.invoice_date);
    this.saveData.invoice_no = this.data.invoice_no;
    this.saveData.made_out_to = this.data.made_out_to;
    // console.log(this.saveData);
    this.putDb(this.saveData);
  },
  deleteChange:function () {
    console.log(this.data.invoice_id);
    this.deleteDb(this.data.invoice_id)
  },
  putDb:function (data) {
    axios.put('./g2g/invoice/update', data)
              .then((response)=> {
                console.log("success");
                console.log(response);
                console.log(data);
                this.glQuery('adddraft').getInvoice(this.data.shm_id,false,'put');
                // this.clickCancel();
                // this.glQuery('addContract').shipMentDeatil(data.shm_id,false,'put');
              })
              .catch((error)=> {
                console.log("error");
                console.log(error);
              })
  },
  deleteDb:function (dataId) {
    axios.delete('./g2g/invoice/delete/id/'+dataId)
              .then((response)=> {
                console.log("success");
                console.log(response);
                console.log(dataId);
                this.glQuery('adddraft').getInvoice(this.data.shm_id,true,'delete');
              })
              .catch((error)=> {
                console.log("error");
                // console.log(error);
              })
  },
});
</script>
</dom-module>
