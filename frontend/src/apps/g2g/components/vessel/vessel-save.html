<link rel="import" href="../../../../../bower_components/gl-form/gl-form-label-input.html">
<link rel="import" href="../../../../../bower_components/gl-form/gl-form-panel.html">
<dom-module id="vessel-save">
  <style include="iron-flex iron-flex-factors iron-flex-alignment gl-size gl-color">
  .text-center{
    text-align: center;
    font-size: var(--font-size-h4);
    font-family: 'rsubold', sans-serif;
    -webkit-font-smoothing: antialiased;
  }
  .top{
    margin-top: 30px;
  }
  .w{
    text-align: center;
  }
  </style>

  <template>
    51515/[[contractId]]
    <gl-form-panel-body>
      <gl-grid-row width="{{getWidth}}">
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-label-input label="ผู้ส่งออก" value="{{data.seller_name_en}}" id="actualShipper" name="actualShipper"></gl-form-label-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <!-- <gl-form-dropdown-menu label="Shipping Line" disabled>
            <paper-menu  class="dropdown-content" attr-for-selected="shiplineId" selected="{{data.shipline_id}}" id="bs" name="bs">
              <paper-item shipline-id="[[data.shipline_id]]">[[data.shipline_name]]</paper-item>
            </paper-menu>
          </gl-form-dropdown-menu> -->
            <gl-form-label-input label="Shipping Line" value="{{data.shipline_name}}" id="shipline_id" name="shipline_id"></gl-form-label-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-label-input label="Shipping Line" value="{{data.ship_name}}" id="ship_id" name="ship_id"></gl-form-label-input>
          <!-- <gl-form-dropdown-menu label="Vessel" disabled>
            <paper-menu  class="dropdown-content" attr-for-selected="shipId" selected="{{data.ship_id}}" id="vesselName" name="vesselName">
              <paper-item ship-id="[[data.ship_id]]">[[data.ship_name]]</paper-item>
            </paper-menu>
          </gl-form-dropdown-menu> -->
        </gl-grid-col>

        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-label-input label="Void No." value="{{data.ship_voy_no}}" id="voidNo" name="voidNo"></gl-form-label-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-label-input label="Lot No." value="{{data.ship_lot_no}}" id="lotNo" name="lotNo"></gl-form-label-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-label-input label="Booking No." value="[[data.book_no]]" id="bn" name="bn"></gl-form-label-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-label-input label="B/L No." value="[[data.bl_no]]" id="package" name="package"></gl-form-label-input>
        </gl-grid-col>

        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-label-input label="Shipping Agent" value="[[data.carrier_name]]" id="" name=""></gl-form-label-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-label-input label="Tel." value="[[data.seller_phone]]"></gl-form-label-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-dropdown-menu label="POL" disabled>
            <paper-menu  class="dropdown-content" attr-for-selected="pol" selected="{{data.load_port_id}}" id="pol" name="pol">
              <paper-item pol="{{data.load_port_id}}">[[data.load_port_name]]</paper-item>
            </paper-menu>
          </gl-form-dropdown-menu>
        </gl-grid-col>

        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <vaadin-date-picker label="ETD" value="{{data.etd_date}}" disabled></vaadin-date-picker>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <vaadin-date-picker label="ETA" value="{{data.eta_date}}" disabled></vaadin-date-picker>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-dropdown-menu label="POD" disabled>
            <paper-menu  class="dropdown-content" attr-for-selected="dest-port-id" selected="{{data.dest_port_id}}" id="cityEnd" name="cityEnd">
              <paper-item dest-port-id="[[data.dest_port_id]]">[[data.dest_port_id]]</paper-item>
            </paper-menu>
          </gl-form-dropdown-menu>
        </gl-grid-col>

        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-label-input label="Place of Delivery" value="{{data.deli_port_id}}" id="pode" name="pode"></gl-form-label-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-label-input label="จำนวนตู้คอนเทนเนอร์" value="[[data.num_of_container]]" id="" name=""></gl-form-label-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <vaadin-date-picker label="Packing Date" value="{{data.packing_date}}" disabled></vaadin-date-picker>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-label-input label="Packing Time"  value="{{data.packing_time}}" ></gl-form-label-input>
        </gl-grid-col>



        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-label-input label="ตู้ละ (ตัน)" value="[[data.weight_per_container]]" id="" name=""></gl-form-label-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <vaadin-date-picker label="Production" value="[[data.product_date]]" disabled></vaadin-date-picker>
        </gl-grid-col>
      </gl-grid-row>
    </gl-form-panel-body>

        <gl-form-panel-body>
          <div class="text-center">รายละเอียดการส่งมอบ</div>
        </gl-form-panel-body>

        <gl-form-panel-body>
          <gl-grid-row>
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
              <gl-form-label-input label="Confirmation Letter" value="{{data.cl_no}}" ></gl-form-label-input>
            </gl-grid-col>
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
              <gl-form-label-input label="Rice Type" value="{{data.type_rice_name_en}}" ></gl-form-label-input>
            </gl-grid-col>
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
              <gl-form-label-input label="Package (kg/PP Bag)" value="{{data.package_name}}" ></gl-form-label-input>

            </gl-grid-col>

            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
              <gl-form-label-input label="Price (USD/MT)" format-number value="{{price.price_per_ton}}"></gl-form-label-input>
            </gl-grid-col>
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
              <gl-form-label-input label="น้ำหนักกระสอบ (gram/bag)" value="{{data.package_weight_bag}}"></gl-form-label-input>
            </gl-grid-col>
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
              <gl-form-label-input label="จำนวน/ตัน" value="{{data.shm_det_quantity}}"></gl-form-label-input>
            </gl-grid-col>

            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
              <gl-form-label-input label="MARKS" value="[[buyerMasks]]"></gl-form-label-input>
            </gl-grid-col>
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
              <gl-form-label-input label="Quantity (BAGS)" value="{{quantityBag}}"></gl-form-label-input>
            </gl-grid-col>
          </gl-grid-row>

          <gl-grid-row>
              <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
                <gl-form-label-input label="WEIGHT (M/T)" value="G.W. {{gw}}"></gl-form-label-input>
              </gl-grid-col>
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
              <gl-form-label-input label="" value="N.W. {{data.shm_det_quantity}}"></gl-form-label-input>
            </gl-grid-col>
          </gl-grid-row>

          <gl-grid-row>
            <gl-grid-col width="[[getWidth]]" grid="[[500,12],[700,12]]">
              <gl-form-label-textarea label="DESCRIPTION OF GOODS" value="{{data.type_rice_name_en}}
              PACKING : {{data.pack_name}}  {{data.weight_bag}} gram/bags"></gl-form-label-textarea>
            </gl-grid-col>
            <gl-grid-col width="[[getWidth]]" grid="[[500,12],[700,6]]">
              <gl-form-label-textarea label="{{quantityWords}}" value="FREIGHT COLLECT SHIPPED ON BOARD "></gl-form-label-textarea>
            </gl-grid-col>

            <gl-grid-col width="[[getWidth]]" grid="[[500,12],[700,1]]"></gl-grid-col>

            <gl-grid-col width="[[getWidth]]" grid="[[500,12],[700,1]]">
              <div class="top">ORIGINALS</div>
            </gl-grid-col>
            <gl-grid-col width="[[getWidth]]" grid="[[500,12],[700,1]]">
              <gl-form-label-input label="" class="w" value="[[data.origin_page]]"></gl-form-label-input>
            </gl-grid-col>
            <div class="top">/</div>
            <gl-grid-col width="[[getWidth]]" grid="[[500,12],[700,1]]">
              <gl-form-label-input label="" class="w" value="[[data.nn_page]]"></gl-form-label-input>
            </gl-grid-col>
            <gl-grid-col width="[[getWidth]]" grid="[[500,12],[700,1]]">
            <div class="top">N/N</div>
            </gl-grid-col>
          </gl-grid-row>

        </gl-form-panel-body>

        <gl-form-panel-footer set-padding="10px 20px 0px 20px">
            <paper-button class="gl-btn-info" raised index="[[index]"></iron-icon>Draft B/L</paper-button>
            <paper-button class="gl-btn-info" raised index="[[index]"></iron-icon>List เรือ</paper-button>
        </gl-form-panel-footer>

  </template>

  <script>
    Polymer({
      is: "vessel-save",
      properties: {
        ship:{
          type:Object,
        },
        data:{
          type:Object,
        }
      },
      observers: [
        'getShip(data.shipline_id)',
        // 'riceType'()
      ],
      toWords: function(num) {

          // Convert numbers to words
          // copyright 25th July 2006, by Stephen Chapman http://javascript.about.com
          // permission to use this Javascript on your web page is granted
          // provided that all of the code (including this copyright notice) is
          // used exactly as shown (you can change the numbering system if you wish)

          // American Numbering System
          var th = ['', 'thousand', 'million', 'billion', 'trillion'];
          // uncomment this line for English Number System
          // var th = ['','thousand','million', 'milliard','billion'];

          var dg = ['zero', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine'];
          var tn = ['ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
          var tw = ['twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
          var s = num.toString();
          s = s.replace(/[\, ]/g, '');
          if (s != parseFloat(s)) return 'not a number';
          var x = s.indexOf('.');
          if (x == -1) x = s.length;
          if (x > 15) return 'too big';
          var n = s.split('');
          var str = '';
          var sk = 0;
          for (var i = 0; i < x; i++) {
              if ((x - i) % 3 == 2) {
                  if (n[i] == '1') {
                      str += tn[Number(n[i + 1])] + ' ';
                      i++;
                      sk = 1;
                  } else if (n[i] != 0) {
                      str += tw[n[i] - 2] + ' ';
                      sk = 1;
                  }
              } else if (n[i] != 0) {
                  str +=
                      dg[n[i]] + ' ';
                  if ((x - i) % 3 == 0) str += 'hundred ';
                  sk = 1;
              }
              if ((x - i) % 3 == 1) {
                  if (sk)
                      str += th[(x - i - 1) / 3] + ' ';
                  sk = 0;
              }
          }
          if (x != s.length) {
              var y = s.length;
              str +=
                  'point ';
              for (var i = x + 1; i < y; i++) str += dg[n[i]] + ' ';
          }
          this.quantityWords = '(' + str.replace(/\s+/g, ' ').toUpperCase() + ' BAGS ONLY)';
          //  str.replace(/\s+/g,' ');
      },
      _getCmlForRiceType : function(e) {
        var selectedItem = e.target.selectedItem;
        if (selectedItem) {
          this.cmlNo = selectedItem.id ;
          // console.log(this.cmlNo);
          var cmls = this.cml.filter(function (cml) { return cml.cl_id == selectedItem.id });
          this.riceType = cmls[0].cl_type_rice;
          // console.log(this.riceType);
        }
      },
      getShip:function (shipline_id) {
        // console.log(shipline_id);
        this.getDb('http://localhost:3000/api/common/ship/shipline/'+shipline_id,(data)=>{
          this.ship = data;
          // console.log(this.ship);
        });
      },
      getDb:function (url,callback) {
        // console.log(url);
        axios.get(url)
          .then(function(response){
            callback(response.data);
          }.bind(this))
          .catch(function (error) {
          }.bind(this));
      },
      _getRiceTypeForPackage : function (e) {
        var selectedItem = e.target.selectedItem;
        if (selectedItem) {
          var packages = this.riceType.filter(function (riceType) { return riceType.type_rice_id == selectedItem.id });
          this.package = packages[0];
        }
      },
      _getPackageForPrice:function (e) {
      // console.log(this.package.package);
      var packageAl = this.package.package;
      var selectedItem = e.target.selectedItem;
      if (selectedItem) {
        var prices = packageAl.filter(function (packageAl) { return packageAl.package_id == selectedItem.packageId });
        this.price = prices[0];
        // console.log(this.price);
      }
      this.quantityBag = (parseFloat(this.price.package_kg_per_bag) * parseFloat(1000)) / parseFloat(this.price.package_weight_bag);
      this.toWords(this.quantityBag);

      this.sumGW = ((parseFloat(this.quantityBag) * (parseFloat(this.price.package_weight_bag) + (parseFloat(this.price.package_kg_per_bag) / parseFloat(1000))) / parseFloat(1000)));
      this.gw = this.sumGW.toFixed(3);
    }
  });
  </script>
</dom-module>
