<link rel="import" href="../../../../../bower_components/gl-form/gl-form-label-input.html">
<link rel="import" href="../../../../../bower_components/gl-form/gl-form-panel.html">
<dom-module id="vessel-edit">
  <style include="iron-flex iron-flex-factors iron-flex-alignment gl-size gl-color">
  .top{
    margin-top: 30px;
  }
  .w{
    text-align: center;
  }
  .text-center{
    text-align: center;
    font-size: var(--font-size-h4);
    font-family: 'rsubold', sans-serif;
    -webkit-font-smoothing: antialiased;
  }
  .width-dropdown{
    width: 100%;
  }
  </style>

  <template>index == [[index]]
    <gl-form-panel set-padding="10px 20px 10px 20px">
      <gl-form-panel-head set-border="1px" set-padding="10px 20px 20px 20px">
        <paper-icon-button icon="create" raised on-tap="editInput" title="Edit" index="[[index]]"></paper-icon-button>
        <paper-icon-button icon="delete" raised on-tap="shipmentDelete" title="Delete" id="[[itemPrimary.shm_det_id]]"></paper-icon-button>
      </gl-form-panel-head>

      <gl-form-panel-body>
        <div class="title">รายละเอียดผู้ส่งออกและเรือ</div>
      </gl-form-panel-body>

    <gl-form-panel-body>
      <gl-grid-row width="{{getWidth}}">
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-combo-box required  id="exporter_id" label="ผู้ส่งออก" item-label-path="seller_name_en" disabled="[[checkInput]]"
            class="requested"    item-value-path="exporter_id"  items="{{common.seller}}" value="{{data.exporter_id}}" on-value-changed="getSellerPhone"></gl-combo-box>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,8]]">
          <gl-form-label-input label="Tel." error-message="กรุณาใส่รายละเอียด" required placeholder="ใส่รายละเอียด" value="{{data.seller_phone}}" id="seller_phone" name="seller_phone"></gl-form-label-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-combo-box id="shipline_id" label="Shipping Line" item-label-path="shipline_name" disabled="[[checkInput]]"
            class="requested"  item-value-path="shipline_id" items="{{common.shipline}}" value="{{data.shipline_id}}" on-value-changed="getShip"></gl-combo-box>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-combo-box id="ship_id" label="Vessel" item-label-path="ship_name" disabled="[[checkInput]]"
          class="requested"    item-value-path="ship_id" items="{{shipInShipline}}" value="{{data.ship_id}}"></gl-combo-box>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-combo-box id="surveyor_id" label="Surveyor" item-label-path="surveyor_name" disabled="[[checkInput]]"
              class="requested"  item-value-path="surveyor_id" items="{{common.surveyor}}" value="{{data.surveyor_id}}"></gl-combo-box>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-input disabled="[[checkInput]]" label="Void No." auto-validate error-message="กรุณาใส่รายละเอียด" required placeholder="ใส่รายละเอียด" value="{{data.ship_voy_no}}"
          class="requested"  id="voidNo" name="voidNo"></gl-form-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-input disabled="[[checkInput]]" label="Lot No." auto-validate error-message="กรุณาใส่รายละเอียด" required placeholder="ใส่รายละเอียด" value="{{data.ship_lot_no}}"
          class="requested"  id="lotNo" name="lotNo"></gl-form-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-input disabled="[[checkInput]]" label="Booking No."class="requested" auto-validate error-message="กรุณาใส่รายละเอียด" required placeholder="ใส่รายละเอียด"  value="{{data.book_no}}" id="book_no" name="book_no"></gl-form-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-input disabled="[[checkInput]]" label="B/L No."class="requested" auto-validate error-message="กรุณาใส่รายละเอียด" required placeholder="ใส่รายละเอียด" value="{{data.bl_no}}" id="bl_no" name="bl_no"></gl-form-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <!-- <gl-form-input label="Shipping Agent" auto-validate error-message="กรุณาใส่รายละเอียด" required placeholder="ใส่รายละเอียด" value="{{shipment.carrier_name}}" id="carrier_name" name="carrier_name"></gl-form-input> -->
          <gl-combo-box id="carrier_id" label="Shipping Agent" item-label-path="carrier_name" disabled="[[checkInput]]"
            class="requested"  item-value-path="carrier_id" items="{{common.carrier}}" value="{{data.carrier_id}}"></gl-combo-box>
        </gl-grid-col>

        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-combo-box id="port_id" label="POL" item-label-path="port_name" disabled="[[checkInput]]"
          class="requested"    item-value-path="port_id" items="{{pol}}" value="{{data.load_port_id}}"></gl-combo-box>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <vaadin-date-picker disabled="[[checkInput]]" label="ETD"class="requested" value="{{data.etd_date}}"></vaadin-date-picker>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <vaadin-date-picker disabled="[[checkInput]]" label="ETA"class="requested" value="{{data.eta_date}}"></vaadin-date-picker>
        </gl-grid-col>

        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-combo-box id="dest_port_id" label="POD" item-label-path="port_name" disabled="[[checkInput]]"
          class="requested" item-value-path="port_id" items="{{pod}}"  value="{{data.dest_port_id}}"></gl-combo-box>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-combo-box id="deli_port_id" label="Place of Delivery" item-label-path="port_name" disabled="[[checkInput]]"
          class="requested" item-value-path="port_id" items="{{pod}}" value="{{data.deli_port_id}}"></gl-combo-box>
        </gl-grid-col>


        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          [[testNum(data.*,'num_of_container')]]
            <gl-form-input disabled="[[checkInput]]" label="จำนวนตู้คอนเทนเนอร์" type="number" class="requested"auto-validate error-message="กรุณาใส่รายละเอียด" pattern="[0-9]*" required placeholder="ใส่รายละเอียด" value="{{data.num_of_container}}" id="num_of_container" name="num_of_container"></gl-form-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <vaadin-date-picker disabled="[[checkInput]]" label="Packing Date"class="requested" value="{{data.packing_date}}"></vaadin-date-picker>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-input disabled="[[checkInput]]" label="Packing Time"class="requested" type="time" auto-validate error-message="กรุณาใส่รายละเอียด" required placeholder="ใส่รายละเอียด" value="{{data.packing_time}}" id="pack_time" name="pack_time"></gl-form-input>
        </gl-grid-col>


        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          [[testNum(data.*,'weight_per_container')]]
          <gl-form-input disabled="[[checkInput]]" label="ตู้ละ (ตัน)"class="requested" type="number" auto-validate error-message="กรุณาใส่รายละเอียด" required pattern="[0-9,,]*" placeholder="ใส่รายละเอียด"
            value="{{data.weight_per_container}}" id="weight_per_container" name="weight_per_container"></gl-form-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <vaadin-date-picker disabled="[[checkInput]]" label="Production"class="requested" value="{{data.product_date}}" name="product_date" id="product_date"></vaadin-date-picker>
        </gl-grid-col>
      </gl-grid-row>
    </gl-form-panel-body>

    <gl-form-panel-body>
      <div class="text-center">รายละเอียดการส่งมอบ</div>
    </gl-form-panel-body>

    <gl-form-panel-body>
      <gl-grid-row>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-label-input  label="Confirmation Letter" value="[[clNo]]" ></gl-form-label-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-combo-box id="type_rice_id" label="ชนิดข้าว" item-label-path="type_rice_name_en" disabled="[[checkInput]]"
          class="requested"    item-value-path="type_rice_id" items="[[clTypeRice]]" value="{{data.type_rice_id}}" on-value-changed="getRiceTypeForPackage"></gl-combo-box>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-combo-box id="package_id" label="Package (kg/PP Bag)" item-label-path="package_name" disabled="[[checkInput]]"
          class="requested"    item-value-path="package_id" items="[[package_id]]" value="{{data.package_id}}" on-value-changed="getPackageForPrice"></gl-combo-box>
        </gl-grid-col>

        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-label-input label="Price (USD/MT)" format-number value="{{price.price_per_ton}}"></gl-form-label-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-label-input label="น้ำหนักกระสอบ (gram/bag)"  value="{{price.package_weight_bag}}"></gl-form-label-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <!-- [[testNum(data.*,'shm_det_quantity')]] -->
          [[testNum(data.*,'shm_det_quantity')]]
          <gl-form-input disabled="[[checkInput]]" label="จำนวน/ตัน" class="requested" type="number" auto-validate error-message="กรุณาใส่รายละเอียด" required placeholder="ใส่รายละเอียด" value="{{data.shm_det_quantity}}"></gl-form-input>
        </gl-grid-col>

        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-label-input label="MARKS"  value="[[buyerMasks]]"></gl-form-label-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-label-input label="Quantity (BAGS)" value="{{quantityBag}}"></gl-form-label-input>
        </gl-grid-col>
      </gl-grid-row>

      <gl-grid-row>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-label-input label="G.W. WEIGHT (M/T)"  value="{{gw}}"></gl-form-label-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-label-input label="N.W. WEIGHT (M/T)"  value="{{nw}}"></gl-form-label-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-label-input label="T.W. WEIGHT (M/T)"  value="{{tw}}"></gl-form-label-input>
        </gl-grid-col>
      </gl-grid-row>
      <gl-grid-row>
        <gl-grid-col width="[[getWidth]]" grid="[[500,12],[700,5]]"></gl-grid-col>


        <gl-grid-col width="[[getWidth]]" grid="[[500,12],[700,1]]">
          <div class="top">ORIGINALS</div>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[500,12],[700,2]]">
          [[testNum(data.*,'origin_page')]]
          <gl-form-input label=""  disabled="[[checkInput]]"class="w padL requested" type="number" value="{{data.origin_page}}"></gl-form-input>
        </gl-grid-col>
        <div class="top">/</div>
        <gl-grid-col width="[[getWidth]]" grid="[[500,12],[700,2]]">
          [[testNum(data.*,'nn_page')]]
          <gl-form-input label=""  disabled="[[checkInput]]"class="w requested" type="number" value="{{data.nn_page}}"></gl-form-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[500,12],[700,1]]">
          <div class="top">N/N</div>
        </gl-grid-col>
      </gl-grid-row>
      <!-- <paper-button  class="gl-btn-success" raised on-tap="checkData" index="[[index]]">
        <iron-icon class="gl-icon-size" icon="save"></iron-icon>checkData</paper-button> -->
    </gl-form-panel-body>
    <gl-form-panel-footer set-padding="10px 20px 0px 20px">
      <template is="dom-if" if="[[checkBtnView(checkBtn)]]">
        <paper-button  class="gl-btn-success" raised on-tap="saveShipment" >
          <iron-icon class="gl-icon-size" icon="save"></iron-icon>บันทึก</paper-button>
        </template>
    </gl-form-panel-footer>

  </gl-form-panel>

  </template>

  <script>
    Polymer({
      is: "vessel-edit",
      behaviors: [vesselBehavior, gl.behavior.core,g2gModelBehavior],
      properties: {
        ship:{
          type:Object,
        },
        data:{
          type:Object,
          notify: true,
        },
        propTest:{
          type:String,
          value:"first"
        },
        common:{
          type:Object
        }
      },
      // listeners: {
      //   'shipline_id.selected-item-changed': 'regularTap'
      // },

      observers: [
        'getCounty(country,common)',
        'getShip(data.shipline_id,common.*)',
        'getRiceTypeForPackage(clTypeRice,data.type_rice_id)',
        // 'getPackageForPrice(package,data.package_id)',
        // 'check(data.shm_det_quantity)',
        'getPrice(contractId)',
        'calc(data.shm_det_quantity)',
        // 'shipment(data.shm_det_quantity)'
      ],
      attached: function() {
        //send to file add-contract
        this.fire('vessel-edit-common',{node:this});
      },
      getPrice:function (contractId) {
          //หาชนิดข้าว
          // console.log(this.data.type_rice_id);
          var typeRiceb =this.data.type_rice_id
          var packages = this.data.package_id;
          var typeRice = this.clTypeRice.filter(function (clTypeRice) { return clTypeRice.type_rice_id == typeRiceb});

          //หาขนาดแพ็คเก็ต
          var packagefil = typeRice[0].package.filter(function (typeRice) { return typeRice.package_id == packages});
          // console.log(packagefil[0].price_per_ton);
          this.price = packagefil[0];

        this.calc(this.data.shm_det_quantity);
      },
      saveShipment:function () {
        delete this.data.carrier_name;
        delete this.data.cl_name;
        delete this.data.cl_no;
        delete this.data.deli_port_code;
        delete this.data.deli_port_name;
        delete this.data.dest_port_code;
        delete this.data.dest_port_name;
        this.data.eta_date=new Date (this.data.eta_date);
        this.data.etd_date=new Date (this.data.eta_date);
        delete this.data.load_port_code;
        delete this.data.load_port_name;
        delete this.data.package_kg_per_bag;
        delete this.data.package_name;
        delete this.data.package_weight_bag;
        this.data.packing_date=new Date (this.data.packing_date);
        this.data.product_date=new Date (this.data.product_date);
        delete this.data.seller_address_en;
        delete this.data.seller_address_th;
        delete this.data.seller_email;
        delete this.data.seller_fax;
        delete this.data.seller_name_en;
        delete this.data.seller_name_th;
        delete this.data.seller_phone;
        delete this.data.seller_tax_id;
        delete this.data.ship_name;
        delete this.data.shipline_name;
        delete this.data.surveyor_name;
        delete this.data.type_rice_name_en;
        delete this.data.type_rice_name_th;
        this.data.id=this.data.shm_det_id
        delete this.data.shm_det_id;
        delete this.data.trader_date_approve;
        delete this.data.trader_distric;
        delete this.data.trader_id;
        delete this.data.trader_name;
        delete this.data.trader_no;
        delete this.data.trader_office;
        delete this.data.trader_province;
        delete this.data.seller_agent;
        // console.log(this.data);
        this.fire('save-Data-shipmentDetail',{
          data:this.data,
          index:this.index
        });
      }

    });
  </script>
</dom-module>
