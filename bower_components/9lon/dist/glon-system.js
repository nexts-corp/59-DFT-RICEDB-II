"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,a){for(var o=0;o<a.length;o++){var t=a[o];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(a,o,t){return o&&e(a.prototype,o),t&&e(a,t),a}}();!function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"beforeRegister",value:function(){this.is="glon-system",this.properties={role:{type:Object,value:[{path:"app1/page1",role:["admin","manager","user1"]}]}}}},{key:"created",value:function(){window.gl.glonSystem=document.querySelector("glon-system"),"undefined"==typeof localStorage.glLanguage&&localStorage.setItem("glLanguage",glonInit.language);var e=jwt_decode("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiVXNlcjEiLCJyb2xlIjoiYWRtaW4ifQ.oRx_ieJoxSZPv7Y8lM03Qv8Qb24PVmuFpWBUxWEkBcg");this.auth=e}},{key:"_routePageChanged",value:function(e){var a=this,o={};if("/"==e.path){var t=glonInit.indexPath.split("/");o={app:t[1],page:t[2]}}else o="undefined"==typeof e.path.split("/")[2]?{app:"error",page:"404"}:this.routeData;var l=function(){var e=document.createElement(o.app+"-"+o.page);e.route=o,a.getLocales(a.layout,o.app,function(t){if(window.mergeLocales=t,a.layout!=a.oldLayout){var l=function(){var t=a.$$("tag-app-load");t.innerHTML="";var l=document.createElement(a.layout);l.route=o,l.page=e,t.appendChild(l)};glonInit.layout!=a.layout?a.importHref(a.resolveUrl("/src/template/"+a.layout+"/"+a.layout+".html"),function(e){l()},function(e){a.changePath("/error/404")},!0):l()}else if("undefined"==typeof a.layout){var n=a.$$("tag-app-load");n.innerHTML="",n.appendChild(e)}else{var n=a.$$("tag-app-load>"+a.layout);n.route=o,n.page=e}a.oldLayout=a.layout})};this.checkRole(o)&&(o={app:"error",page:"403"}),this.importHref(this.resolveUrl("/src/apps/"+o.app+"/"+o.page+".html"),function(e){l()},function(e){o={app:"error",page:"404"},a.importHref(a.resolveUrl("/src/apps/"+o.app+"/"+o.page+".html"),function(e){l()},null,!0)},!0)}},{key:"changePath",value:function(e){this.$.changePath.setAttribute("href",e),this.$.changePath.click()}},{key:"getLocales",value:function(e,a,o){var t=function(){var t=JSON.parse(JSON.stringify(locales.global));if("undefined"!=typeof locales.layouts[e])for(var l in locales.layouts[e])for(var n in locales.layouts[e][l])t[l][n]=locales.layouts[e][l][n];for(var l in locales.apps[a])for(var n in locales.apps[a][l])t[l][n]=locales.apps[a][l][n];o(t)},l={global:!1,layout:!1,app:!1,loaded:function(e){this[e]=!0,this.global&&this.layout&&this.app&&t()}};"undefined"==typeof locales&&(window.locales={global:null,apps:{},layouts:{}}),null==locales.global?axios.get("/src/apps/localize.json").then(function(e){locales.global=e.data,l.loaded("global")}):l.loaded("global"),"undefined"==typeof locales.layouts[e]?axios.get("/src/template/"+e+"/localize.json").then(function(a){locales.layouts[e]=a.data,l.loaded("layout")}):l.loaded("layout"),"undefined"==typeof locales.apps[a]?axios.get("/src/apps/"+a+"/localize.json").then(function(e){locales.apps[a]=e.data,l.loaded("app")}):l.loaded("app")}},{key:"checkRole",value:function(e){var a=this,o=!0;return this.role.map(function(t,l){t.path==e.app+"/"+e.page?t.role.map(function(e){a.auth.role==e&&(o=!1)}):o=!1}),o}},{key:"observers",get:function(){return["_routePageChanged(route)"]}}]),e}();Polymer(e)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdsb24tc3lzdGVtLmpzIl0sIm5hbWVzIjpbIkdsb25TeXN0ZW0iLCJfY2xhc3NDYWxsQ2hlY2siLCJ0aGlzIiwiX2NyZWF0ZUNsYXNzIiwia2V5IiwidmFsdWUiLCJpcyIsInByb3BlcnRpZXMiLCJyb2xlIiwidHlwZSIsIk9iamVjdCIsIndpbmRvdyIsImdsIiwiZ2xvblN5c3RlbSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImxvY2FsU3RvcmFnZSIsImdsTGFuZ3VhZ2UiLCJsYW5ndWFnZSIsInNldEl0ZW0iLCJhdXRoIiwiZGVjb2RlZCIsIl90aGlzIiwicm91dGVEYXRhIiwiZ2V0Um91dGUiLCJwYXRoIiwiaW5kZXhQYXRoIiwiZ2xvbkluaXQiLCJhcHAiLCJwYWdlIiwic3BsaXQiLCJnZXRQYWdlIiwiY3JlYXRlRWxlbWVudCIsInJvdXRlIiwiZ2V0TG9jYWxlcyIsImxheW91dCIsImRhdGEiLCJyZW5kZXJQYWdlIiwibWVyZ2VMb2NhbGVzIiwicmVuZGVyTGF5b3V0IiwicXVlcnlUYWciLCJpbm5lckhUTUwiLCJvbGRMYXlvdXQiLCJnZXRMYXlvdXQiLCJhcHBlbmRDaGlsZCIsImltcG9ydEhyZWYiLCJlIiwiY2hhbmdlUGF0aCIsIiQkIiwiY2hlY2tSb2xlIiwicmVzb2x2ZVVybCIsIiQiLCJzZXRBdHRyaWJ1dGUiLCJjbGljayIsImNhbGxiYWNrIiwibWVyZ2VEYXRhIiwiSlNPTiIsInBhcnNlIiwic3RyaW5naWZ5IiwibG9jYWxlcyIsImdsb2JhbCIsImxheW91dHMiLCJrZXkyIiwicG9pbnRlciIsImFwcHMiLCJsb2NhbGVzTG9hZGVkIiwibG9hZGVkIiwiZ2V0IiwidGhlbiIsInJlc3BvbnNlIiwiYXhpb3MiLCJyZWRpcmVjdCIsImluZGV4Iiwib2JqIiwiX3RoaXMyIiwibWFwIiwic09iaiIsIlBvbHltZXIiXSwibWFwcGluZ3MiOiI4WEFBQSxXQUFZLEdBSUFBLEdBSkEsV0FBQSxRQUFBQSxLQUFBQyxnQkFBQUMsS0FBQUYsR0FB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QUFBeEUsS0E3TVZxRSxHQUFBLENBMk5GLE9BM05FckUsTUFBQU0sS0FBQW1FLElBQUEsU0FBQUYsRUFBQUQsR0FnTkdDLEVBQUloRCxNQUFPRyxFQUFJQSxJQUFJLElBQUlBLEVBQUlDLEtBaUI1QjdCLEVBQUFBLEtBQVIyRSxJQUFBLFNBQUFDLEdBak9ORixFQUFBdEQsS0FBQVosTUFBQW9FLElBbU5rQkwsR0FBVyxLQUlmQSxHQUFXLElBSVJBLEtBM05MbkUsSUFBQSxZQUFBK0QsSUFBQSxXQUNOLE9BT00sZ0NBUkFuRSxJQWlPTjZFLFNBQVE3RSIsImZpbGUiOiJnbG9uLXN5c3RlbS5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcbiAgICAgICd1c2Ugc3RyaWN0JztcbiAgICBcbiAgICBcbiAgICAgIGNsYXNzIEdsb25TeXN0ZW0ge1xuXG4gICAgICAgIGdldCBvYnNlcnZlcnMoKSB7XG4gICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICdfcm91dGVQYWdlQ2hhbmdlZChyb3V0ZSknXG4gICAgICAgICAgXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGJlZm9yZVJlZ2lzdGVyKCkge1xuICAgICAgICAgIHRoaXMuaXMgPSAnZ2xvbi1zeXN0ZW0nO1xuICAgICAgICAgIHRoaXMucHJvcGVydGllcyA9IHtcbiAgICAgICAgICAgIHJvbGU6e1xuICAgICAgICAgICAgICB0eXBlOk9iamVjdCxcbiAgICAgICAgICAgICAgdmFsdWU6W1xuICAgICAgICAgICAgICAgIHsgcGF0aDonYXBwMS9wYWdlMScscm9sZTpbJ2FkbWluJywnbWFuYWdlcicsJ3VzZXIxJ119XG4gICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY3JlYXRlZCgpe1xuICAgICAgICAgIHdpbmRvdy5nbC5nbG9uU3lzdGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImdsb24tc3lzdGVtXCIpO1xuXG4gICAgICAgICAgaWYodHlwZW9mIGxvY2FsU3RvcmFnZS5nbExhbmd1YWdlID09ICd1bmRlZmluZWQnKXtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiZ2xMYW5ndWFnZVwiLCBnbG9uSW5pdC5sYW5ndWFnZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIGRlY29kZWQgPSBqd3RfZGVjb2RlKCdleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKMWMyVnlJam9pVlhObGNqRWlMQ0p5YjJ4bElqb2lZV1J0YVc0aWZRLm9SeF9pZUpveFNaUHY3WThsTTAzUXY4UWIyNFBWbXVGcFdCVXhXRWtCY2cnKTtcbiAgICAgICAgICB0aGlzLmF1dGggPSBkZWNvZGVkO1xuICAgICAgICB9XG5cbiAgICAgICAgX3JvdXRlUGFnZUNoYW5nZWQoZ2V0Um91dGUpe1xuXG4gICAgICAgICAgdmFyIHJvdXRlRGF0YSA9IHt9O1xuICAgICAgICAgIGlmKGdldFJvdXRlLnBhdGggPT0gXCIvXCIpe1xuICAgICAgICAgICAgdmFyIGluZGV4UGF0aCA9IGdsb25Jbml0LmluZGV4UGF0aC5zcGxpdCgnLycpO1xuICAgICAgICAgICAgcm91dGVEYXRhID0geyBhcHA6aW5kZXhQYXRoWzFdLHBhZ2U6aW5kZXhQYXRoWzJdIH07XG4gICAgICAgICAgfWVsc2UgaWYodHlwZW9mIGdldFJvdXRlLnBhdGguc3BsaXQoJy8nKVsyXSA9PSBcInVuZGVmaW5lZFwiKXtcbiAgICAgICAgICAgIHJvdXRlRGF0YSA9IHsgYXBwOidlcnJvcicscGFnZTonNDA0JyB9O1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgcm91dGVEYXRhID0gdGhpcy5yb3V0ZURhdGE7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIHJlbmRlclBhZ2UgPSAoKT0+e1xuICAgICAgICAgICAgICAgIHZhciBnZXRQYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChyb3V0ZURhdGEuYXBwKyctJytyb3V0ZURhdGEucGFnZSk7XG4gICAgICAgICAgICAgICAgZ2V0UGFnZS5yb3V0ZSA9IHJvdXRlRGF0YTtcblxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0TG9jYWxlcyh0aGlzLmxheW91dCxyb3V0ZURhdGEuYXBwLChkYXRhKT0+e1xuICAgICAgICAgICAgICAgICAgd2luZG93Lm1lcmdlTG9jYWxlcyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgICBpZigodGhpcy5sYXlvdXQhPXRoaXMub2xkTGF5b3V0KSl7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlbmRlckxheW91dCA9ICgpPT57XG4gICAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5VGFnID0gdGhpcy4kJCgndGFnLWFwcC1sb2FkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgcXVlcnlUYWcuaW5uZXJIVE1MPScnO1xuICAgICAgICAgICAgICAgICAgICAgIHZhciBnZXRMYXlvdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRoaXMubGF5b3V0KTtcbiAgICAgICAgICAgICAgICAgICAgICBnZXRMYXlvdXQucm91dGUgPSByb3V0ZURhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgZ2V0TGF5b3V0LnBhZ2UgPSBnZXRQYWdlO1xuICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5VGFnLmFwcGVuZENoaWxkKGdldExheW91dCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZihnbG9uSW5pdC5sYXlvdXQhPXRoaXMubGF5b3V0KXtcblxuICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW1wb3J0SHJlZihcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNvbHZlVXJsKCcvc3JjL3RlbXBsYXRlLycrdGhpcy5sYXlvdXQrJy8nK3RoaXMubGF5b3V0KycuaHRtbCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgKGUpPT57XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlckxheW91dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIChlKT0+e1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZVBhdGgoJy9lcnJvci80MDQnKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgcmVuZGVyTGF5b3V0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKHR5cGVvZiB0aGlzLmxheW91dCA9PSBcInVuZGVmaW5lZFwiKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5VGFnID0gdGhpcy4kJCgndGFnLWFwcC1sb2FkJyk7XG4gICAgICAgICAgICAgICAgICAgIHF1ZXJ5VGFnLmlubmVySFRNTD0nJztcbiAgICAgICAgICAgICAgICAgICAgcXVlcnlUYWcuYXBwZW5kQ2hpbGQoZ2V0UGFnZSk7XG4gICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5VGFnID0gdGhpcy4kJCgndGFnLWFwcC1sb2FkPicrdGhpcy5sYXlvdXQpO1xuICAgICAgICAgICAgICAgICAgICBxdWVyeVRhZy5yb3V0ZSA9IHJvdXRlRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgcXVlcnlUYWcucGFnZSA9IGdldFBhZ2U7XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIHRoaXMub2xkTGF5b3V0ID0gdGhpcy5sYXlvdXQ7XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICBpZih0aGlzLmNoZWNrUm9sZShyb3V0ZURhdGEpKXtcbiAgICAgICAgICAgIHJvdXRlRGF0YSA9IHsgYXBwOidlcnJvcicscGFnZTonNDAzJyB9O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMuaW1wb3J0SHJlZihcbiAgICAgICAgICAgIHRoaXMucmVzb2x2ZVVybCgnL3NyYy9hcHBzLycrcm91dGVEYXRhLmFwcCsnLycrcm91dGVEYXRhLnBhZ2UrJy5odG1sJyksXG4gICAgICAgICAgICAoZSk9PntcbiAgICAgICAgICAgICAgcmVuZGVyUGFnZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIChlKT0+e1xuICAgICAgICAgICAgICAgIHJvdXRlRGF0YSA9IHsgYXBwOidlcnJvcicscGFnZTonNDA0JyB9O1xuICAgICAgICAgICAgICAgIHRoaXMuaW1wb3J0SHJlZihcbiAgICAgICAgICAgICAgICAgIHRoaXMucmVzb2x2ZVVybCgnL3NyYy9hcHBzLycrcm91dGVEYXRhLmFwcCsnLycrcm91dGVEYXRhLnBhZ2UrJy5odG1sJyksXG4gICAgICAgICAgICAgICAgICAoZSk9PntcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyUGFnZSgpO1xuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgICB0cnVlXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0cnVlXG4gICAgICAgICAgKTtcbiAgICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIH1cblxuXG4gICAgICAgIGNoYW5nZVBhdGgocGF0aCl7XG4gICAgICAgICAgdGhpcy4kLmNoYW5nZVBhdGguc2V0QXR0cmlidXRlKFwiaHJlZlwiLCBwYXRoKTtcbiAgICAgICAgICB0aGlzLiQuY2hhbmdlUGF0aC5jbGljaygpO1xuICAgICAgICB9XG5cblxuICAgICAgICBnZXRMb2NhbGVzKGxheW91dCxhcHAsY2FsbGJhY2spe1xuXG4gICAgICAgICAgdmFyIG1lcmdlTG9jYWxlcyA9ICgpID0+IHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIG1lcmdlRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkobG9jYWxlcy5nbG9iYWwpKTtcbiAgICAgIFxuXG4gICAgICAgICAgICBpZih0eXBlb2YgbG9jYWxlcy5sYXlvdXRzW2xheW91dF0gIT0gXCJ1bmRlZmluZWRcIil7XG4gICAgICAgICAgICAgIGZvcih2YXIga2V5IGluIGxvY2FsZXMubGF5b3V0c1tsYXlvdXRdKSB7XG4gICAgICAgICAgICAgICAgICBmb3IodmFyIGtleTIgaW4gbG9jYWxlcy5sYXlvdXRzW2xheW91dF1ba2V5XSkge1xuICAgICAgICAgICAgICAgICAgICBtZXJnZURhdGFba2V5XVtrZXkyXSA9IGxvY2FsZXMubGF5b3V0c1tsYXlvdXRdW2tleV1ba2V5Ml07XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gXG5cbiAgICAgICAgICAgIGZvcih2YXIga2V5IGluIGxvY2FsZXMuYXBwc1thcHBdKSB7XG4gICAgICAgICAgICAgICAgZm9yKHZhciBrZXkyIGluIGxvY2FsZXMuYXBwc1thcHBdW2tleV0pIHtcbiAgICAgICAgICAgICAgICAgIG1lcmdlRGF0YVtrZXldW2tleTJdID0gbG9jYWxlcy5hcHBzW2FwcF1ba2V5XVtrZXkyXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYWxsYmFjayhtZXJnZURhdGEpO1xuXG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIGxvY2FsZXNMb2FkZWQgPSB7XG4gICAgICAgICAgICBnbG9iYWw6ZmFsc2UsXG4gICAgICAgICAgICBsYXlvdXQ6ZmFsc2UsXG4gICAgICAgICAgICBhcHA6ZmFsc2UsXG4gICAgICAgICAgICBsb2FkZWQ6ZnVuY3Rpb24gKHBvaW50ZXIpIHtcbiAgICAgICAgICAgICAgdGhpc1twb2ludGVyXSA9IHRydWU7XG4gICAgICAgICAgICAgIGlmKHRoaXMuZ2xvYmFsJiZ0aGlzLmxheW91dCYmdGhpcy5hcHApe1xuICAgICAgICAgICAgICAgIG1lcmdlTG9jYWxlcygpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG5cbiAgICAgICAgICBpZih0eXBlb2YgbG9jYWxlcyA9PSAndW5kZWZpbmVkJyl7XG4gICAgICAgICAgICB3aW5kb3cubG9jYWxlcyA9IHtnbG9iYWw6bnVsbCxhcHBzOnt9LGxheW91dHM6e319O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmKGxvY2FsZXMuZ2xvYmFsPT1udWxsKXtcbiAgICAgICAgICAgIGF4aW9zLmdldCgnL3NyYy9hcHBzL2xvY2FsaXplLmpzb24nKVxuICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKT0+e1xuICAgICAgICAgICAgICBsb2NhbGVzLmdsb2JhbCA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICAgIGxvY2FsZXNMb2FkZWQubG9hZGVkKCdnbG9iYWwnKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBsb2NhbGVzTG9hZGVkLmxvYWRlZCgnZ2xvYmFsJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYodHlwZW9mIGxvY2FsZXMubGF5b3V0c1tsYXlvdXRdID09ICd1bmRlZmluZWQnKXtcbiAgICAgICAgICAgIGF4aW9zLmdldCgnL3NyYy90ZW1wbGF0ZS8nK2xheW91dCsnL2xvY2FsaXplLmpzb24nKVxuICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKT0+e1xuICAgICAgICAgICAgICBsb2NhbGVzLmxheW91dHNbbGF5b3V0XSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICAgIGxvY2FsZXNMb2FkZWQubG9hZGVkKCdsYXlvdXQnKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBsb2NhbGVzTG9hZGVkLmxvYWRlZCgnbGF5b3V0Jyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYodHlwZW9mIGxvY2FsZXMuYXBwc1thcHBdID09ICd1bmRlZmluZWQnKXtcbiAgICAgICAgICAgIGF4aW9zLmdldCgnL3NyYy9hcHBzLycrYXBwKycvbG9jYWxpemUuanNvbicpXG4gICAgICAgICAgICAudGhlbigocmVzcG9uc2UpPT57XG4gICAgICAgICAgICAgIGxvY2FsZXMuYXBwc1thcHBdID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgbG9jYWxlc0xvYWRlZC5sb2FkZWQoJ2FwcCcpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIGxvY2FsZXNMb2FkZWQubG9hZGVkKCdhcHAnKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG5cbiAgICAgICAgY2hlY2tSb2xlKGFwcCl7XG4gICAgICAgICAgdmFyIHJlZGlyZWN0ID0gdHJ1ZTtcbiAgICAgICAgICB0aGlzLnJvbGUubWFwKChvYmosaW5kZXgpPT57XG4gICAgICAgICAgICBpZihvYmoucGF0aD09KGFwcC5hcHArJy8nK2FwcC5wYWdlKSl7XG4gICAgICAgICAgICAgIG9iai5yb2xlLm1hcCgoc09iaik9PntcbiAgICAgICAgICAgICAgICBpZih0aGlzLmF1dGgucm9sZT09c09iail7XG4gICAgICAgICAgICAgICAgICByZWRpcmVjdCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgcmVkaXJlY3QgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIHJldHVybiByZWRpcmVjdDtcbiAgICAgICAgfVxuICAgICAgICAgIFxuXG4gICAgICB9XG5cbiAgICAgIFBvbHltZXIoR2xvblN5c3RlbSk7XG5cbiAgICB9KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
